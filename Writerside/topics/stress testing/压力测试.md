# 业务接口性能压测报告

## 说明

本次压力测试主要是为了应对抽奖活动推广，找出系统瓶颈， 提高单台服务器及整个集群的吞吐量，并根据负载均衡SLB， 系统（cpu、mem、io、network、进程及文件限制，内核参数）， nginx服务，java服务等进行优化，先后对活动参与首页(p1)、活动开奖页(p2)， 并通过单Pod节点， 多Pod节点进行压力测试； 并对产生的数据进行汇总。

## 压测工具

apache-jmeter-5.4.3

## 压测接口

/activity/blindBox/activity/page 协议: http 方法: get 活动参与页

## 压测性能相关参数

并发线程数 总样本个数 响应时间均值 响应时间中位数 90%响应时间 95%响应时间 99%响应时间 错误率 吞吐率(TPS)

## 测试目标

获取在单机部署情况下最大TPS值

是否可以达到以下预期：

单个实例部署 模拟普通用户请求场景 预期值TPS：50

单个实例部署 模拟首页不登陆直接请求 预期值TPS：100

## 测试环境

### 被测服务参数

lasogene-activity pod内存：512Mi jvm参数：-XX:MetaspaceSize=100m -XX:MaxMetaspaceSize=150m -Xmx256m -Xms256m -Xmn150m -Xss228k

## 流量限制

二级域名 流量限制 1M 内网 流量限制 4M 生产 环境流量限制 15M

## 测试结果

### 模拟普通用户请求场景

固定线程数 1s内陆续启动，无限循环 高斯定时 500ms+Random(0-500)

线程数150 1个实例

![img](CA15E52D-354D-4E24-A4FA-08396858A1C7.png)

线程数200 2个实例

![img](5A450445-3108-487A-A60F-ACE379DD87CD.png)

线程数200 3个实例

![img](F9E1F1F6-9810-4704-9BFD-955E9E9399D2.png)

线程数250 4个实例

![img](C29B9458-3C50-49EC-B3D2-D6E072E6B3A5.png)

根据图可知2个实例和3个实例tps增长缓慢 3实例和4实例 tps基本无增长，可知此处出现资源限制 根据接受流量计算 480 * 8 / 1024 约等于 4mps 因此得到限制为带宽 登录阿里云服务器查看流量监控得以印证

### 模拟首页不登陆直接请求

固定线程数 1s内陆续启动，无限循环 高斯定时 500ms+Random(0-500)

线程数150 1个实例

![img](2C4382FA-185C-458B-8A5C-CDC371EDFCDC.png)

线程数200 2个实例

![img](AD1B585C-D289-45AE-8A06-9011411EC624.png)

线程数250 3个实例

![img](5892E9D3-B454-4149-93C6-5711E4EEE04E.png)

根据图可知2个实例和3个实例tps基本无增长，可知此处出现资源限制， 由于全程在和redis交互 所以备选瓶颈 为 redis、带宽、内存

观测pod中jstat -gcutil 发现老年代增长极为缓慢 所有gc均为新生代gc 所以不存在内存限制

![1653276441603](1653276441603.jpg)

观测redis info 中instantaneous *ops*per_sec（瞬时处理操作数） 可知远没有达到redis瓶颈

![image-20220317111735856](image-20220317111735856-7487064.png)

因此得到限制为带宽 登录阿里云服务器查看流量监控得以印证

### 综上

根据测试环境内网带宽为4m 生产环境为15m 故可以得到在资源、参数不变的情况下 线上环境开启10个实例较为合适， 普通用户请求可以达到700的tps，不登陆直接请求可以达到2000左右的tps