# Mysql事务学习

## 一、事务定义(Transaction)

>* Transaction
>* 事务：一个最小的不可再分的工作单元；通常一个事务对应一个完整的业务(例如银行账户转账业务，该业务就是一个最小的工作单元)
>* 一个完整的业务需要批量的DML(insert、update、delete)语句共同联合完成

## 二、事务四大特征(ACID)

* atomicity：原子性
*  consistency 一致性，一个事务可以封装状态改变，保持系统始终处于一致
  的状态。以银行账户为例，假设有5个账户，每个账户余额都是100元，即使账
  户之间同时发生多个转账(多个事务并发)，但从其它事务中查看，5个账户的总
  额都总是500元，不多不少，保持一致性。
*  isolation 隔离性，不同事务之间相互隔离，就好像在给定时间内，系统只执
  行唯一的事务。
* durability 持久性，一旦事务成功完成，事务对数据库的修改，将会持久保
  存在数据库中。

## 三、事务的隔离级别(Isolation)

SQL 标准定义了四种隔离级别，MySQL 全都支持。这四种隔离级别分别是：

1. 读未提交（Read uncommitted）

  读未提交，顾名思义，在Read uncommitted 级别下，当前事务中的修改，即使没有提交，在其他事务中都是可见的。事务可以读取其他事务未提交的数据，这被称为脏读（Dirty Read）。

2. 读提交 （Read committed）

  一个事务开始时，只能看到自己提交的事务所做的更改。一个事务从开始直到提交，所做的任何修改对其他事务都是不可见的。这个级别也叫做不可重复读，norepeatable read，因为执行2次同样的查询，可能会得到不一样的结果。

3. 可重复读 （Repeatable read）(My sql 默认隔离级别)

   该级别保证在同一事务中，多次读取数据的结果一致。理论上，repeatable read还无法解决另一个幻读（Phantom read）的问题，所谓幻读，就是指当前事务在读取某一个范围内的数据的时候，另外一个事务又在该范围内新增了数据。当再次读取这个范围的时候，就会产生幻行（Phantom row）。InnoDB 通过MVCC多版本并发控制（Multiversion Concurrency Control）解决了幻读的问题。

4. 串行化 （Serializable）

	串行这一级别的事务，被要求强制串行执行。会在读取的每一行数据上加锁，可能会造成大量的锁等待，超时，锁争用等问题，需在某些强一致性的场景下使用。

![image-20220929094844813](image-20220929094844813.png)

可以使用  **`SELECT @@tx_isolation `** 查看当前数据库隔离级别

## 四、事务相关知识点

* 刚性事务：ACID（本地事务）
* 柔性事务：cap\base（分布式事务）


| 事务类型  | 时间要求 | 一致性要求  | 应用类型 | 场景 |
| :------: | :------: | :------: | :------: | :------: |
| 刚性事务 | 立刻\马上 | 强一致性   | 局域网\企业应用 | 订单\日志 |
| 柔性事务 | 有时间弹性 | 最终一致性 | 互联网应用  | 付款\订单\收货 |

#####  cap理论 

##### 定义：

* 数据一致性（consistency）
* 服务可用性（availability）
* 分区容错性（partition-tolerance）

结论：在分布式环境下最多只能保证2个。P是必须的 cp \ ap

SQL 分类

| 分类  | 全称 | 说明 |
| :------: | :------: | :------: |
| DDL | Data Definition Language | 数据定义语言,用来定义数据库对象（数据库,表,字段）| 
| DML | Data Manipulation Language | 数据操作语言,用来对数据库表中的数据进行增删改 | 
| DQL | Data Query Language | 数据查询语言,用来查询数据库中表的记录 | 
| DCL | Data Control Language | 数据控制语言,用来创建数据库用户、控制数据库的访问权限 | 

