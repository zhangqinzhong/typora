# 微服务引擎MSE

## 配置路由

* 登录阿里云RAM账号：ywzt-develop@1071794100325015.onaliyun.com
* 搜索进入云产品：微服务引擎MSE
* 在上方导航栏选择 华北二（北京）
* 打开左侧导航栏云原生网关 -> 网关列表
* 在网关列表中选择相应的环境进入，例如：feihetest2gw（sit2环境）
* 点击左侧导航栏，选择路由配置，进入
* 在路由配置中，创建路由

![image-20221221151631380](image-20221221151631380.png)

![image-20221221151732770](image-20221221151732770.png)

## 配置鉴权

* 点击左侧导航栏 -> 插件市场

* 点击已启用插件

* 点击jwt-auth

* 点击插件配置

* <img src="/Users/zhangqinzhong/Documents/typora/飞鹤/images//image-20230103182739197.png" alt="image-20230103182739197" style="zoom:50%;" />

* 点击编辑后，点放大进入编辑页面，如下图

* ![image-20230103182858049](image-20230103182858049.png)

* 图中红框圈中的内容为一个JWT鉴权整体，推荐复制一份，再进行配置，只需要替换结构体中的keys

## token以及鉴权结构体公钥json生成

使用java代码生成：

代码在tb项目中。
com.alibaba.adapter.application.JwtTokenGenerateTest

是一个可以本地执行的main方法。直接本地运行生成Token。然后配置在MSE中。
注意：可以修改生成的token有效期，在代码注释中有标注。tb项目中的默认token有效期是10年。

#### 将生成的公钥结构体复制到配置页面中进行配置

#### 鉴权结构体参数说明：

![image-20230103183353888](image-20230103183353888.png)

* 在配置页面往下滑，最底下配置需要进行鉴权的路由，以及选择对应的鉴权结构体。

![image-20230103183511909](image-20230103183511909.png)



# 注意：一定要将生成好的token放在MSE中的插件配置中。以注释的形式。# XXXX

# 可以参考之前别人是怎么写的。

# 重点注意，match_route是路由，路由在整个配置文件中只能出现一次。



![image-20230207132100242](image-20230207132100242.png)

![image-20230207132113734](image-20230207132113734.png)

![image-20230207132128245](image-20230207132128245.png)

# 配置重写策略

更新时间：2022年7月29日 00:51:00

在请求转发给目标后端服务之前，重写可以修改原始请求的路径（Path）和主机域（Host），本文介绍如何配置重写策略。

## 背景信息

通常情况下，重写主要用于修改原始请求的路径（Path）和主机域（Host）。

路径（Path）重写

对于路径（Path）重写，云原生网关支持3种重写模式，精确重写、前缀重写和正则重写。

- 精确重写

  ：精确重写可以完全修改原始请求的Path。

  例如，原始请求的Path为/app/test，但转发给后端服务的Path为/foo/bar，建议配置方式如下：

  - 路由匹配条件：匹配方式为精确匹配，Path为/app/test。
  - 重写：重写方式为精确重写，Path为/foo/bar。

  **注意** 精确重写要求路由的匹配方式为精确匹配或正则匹配，前缀匹配不支持精确重写。

| 参数     | 描述                                                         |
| ------------------ | :-------------------- |
| 原路径   | 显示当前路由的匹配方式和匹配Path。其中匹配方式包括精确匹配、前缀匹配和正则匹配。 |
| 重写路径 | 您可以选择重写路径的匹配方式和匹配Path。<br />    1. 若原路径的匹配方式为精确匹配或正则匹配时，重写路径匹配方式可以选择精确重写。<br />    2. 若原路径的匹配方式为前缀匹配时，重写路径匹配方式可以选择前缀重写或正则重写。<br />    3. 若原路径的匹配方式为正则匹配时，重写路径匹配方式可以选择精确重写和正则重写。 |
| 原主机域 | 显示当前路由所属的主机域。                                   |
| 重写主机 | 输入重写后的主机域。                                         |
