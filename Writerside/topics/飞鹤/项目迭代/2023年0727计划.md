1. 三方拉单灰度支持
1. rainbow接口迁移到tc



SIT2 SQL脚本

```text
ALTER TABLE `fh_oms`.`oms_order`
ADD COLUMN `gray_platform` tinyint(1) UNSIGNED DEFAULT 0 COMMENT '灰度标识 0 基础环境订单 1灰度订单' AFTER `error_code`;
```



UAT2 SQL脚本

```text
ALTER TABLE `fh_oms_uat2`.`oms_order`
ADD COLUMN `gray_platform` tinyint(1) UNSIGNED DEFAULT 0 COMMENT '灰度标识 0 基础环境订单 1灰度订单' AFTER `error_code`;

ALTER TABLE `fh_oms_uat2`.`oms_order_archive`
ADD COLUMN `gray_platform` tinyint(1) UNSIGNED DEFAULT 0 COMMENT '灰度标识 0 基础环境订单 1灰度订单' AFTER `error_code`;
```



PROD SQL脚本

```text
ALTER TABLE `fh_oms_ywzt`.`oms_order`
ADD COLUMN `gray_platform` tinyint(1) UNSIGNED DEFAULT 0 COMMENT '灰度标识 0 基础环境订单 1灰度订单' AFTER `error_code`;

ALTER TABLE `fh_oms_ywzt`.`oms_order_archive`
ADD COLUMN `gray_platform` tinyint(1) UNSIGNED DEFAULT 0 COMMENT '灰度标识 0 基础环境订单 1灰度订单' AFTER `error_code`;
```

```text
#=================== 三方拉单灰度配置 start ======================
gray:
  douyin:
    gray_outer_user_id:
    gray_outer_skuid:
    gray_gray_url: http://fh01.uat.feihe.com/tiktok/trade/order/msg?monitor
    gray_token: 
    gray_switch: true
  jd:
    gray_outer_user_id:
    gray_outer_skuid: 10053165692930
    gray_gray_url: http://fh01.uat.feihe.com/jd/message/notifyMessage
    gray_token: 
    gray_switch: true
  kuaishou:
    gray_outer_user_id:
    gray_outer_skuid:
    gray_gray_url: http://fh01.uat.feihe.com/kuaishou/trade/event/
    gray_token: 
    gray_switch: true
  pdd:
    gray_outer_user_id:
    gray_outer_skuid:
    gray_gray_url: http://fh01.uat.feihe.com/pdd/sendPddMessage
    gray_token: 
    gray_switch: true
  tmall:
    gray_outer_user_id: 
    gray_outer_skuid:
    gray_gray_url: http://fh01.uat.feihe.com/tmall/trade/sync
    gray_token: 
    gray_switch: true
  vopvip:
    gray_outer_user_id:
    gray_outer_skuid:
    gray_gray_url: 
    gray_token: 
    gray_switch: true
#=================== 三方拉单灰度配置 end ======================
```



注意事项：

抖音灰度URL配置需要手动拼接form。

```
http://localhost/trade/order/msg?monitor
```



 天猫推送有jwt

灰度转发的时候要配置jwt



如果生产灰度没有唯品会定时任务 也需要配置

```bash
curl 172.17.179.156:8080/tmall/trade/sync -X POST -d '{"hello": "world"}' --header "Content-Type: application/json"
```



生产域名：

```text
https://fh01.feihe.com
```



上线pdd生产环境需要配置灰度网关。正向售后同一个。

```text
POST /pdd/sendPddMessage
```



rainbow迁移tc 网关配置

```text
https://fh01.feihe.com/api/foreign/order/selectPage
```



```text
MSE：
实例名称：飞鹤-业务中台-UAT环境
实例id：mse_prepaid_public_cn-oew1tzqha02
命名空间：FH-ACM-UAT
命名空间id: af32cba7-037f-4398-bf33-c59c192c64a0
groupId：com.alibaba.adapter
dataId：adapter-center-tb-prod2-new-fh.yaml


#=================== 三方拉单灰度配置 start ======================
gray:
  douyin:
    gray_outer_user_id:
    gray_outer_skuid:
    gray_gray_url: http://fh01.feihe.com/tiktok/trade/order/msg?monitor
    gray_token: xxx
    gray_switch: false
  jd:
    gray_outer_user_id:
    gray_outer_skuid:
    gray_gray_url: https://fh01.feihe.com/jd/message/notifyMessage
    gray_token: xxx
    gray_switch: false
  kuaishou:
    gray_outer_user_id:
    gray_outer_skuid:
    gray_gray_url: https://fh01.feihe.com/kuaishou/trade/event/
    gray_token: xxx
    gray_switch: false
  pdd:
    # pdd没有用户ID配置
    gray_outer_user_id:
    gray_outer_skuid:
    gray_gray_url: https://fh01.feihe.com/pdd/sendPddMessage
    gray_token: xxx
    gray_switch: false
  tmall:
    gray_outer_user_id: 
    gray_outer_skuid:
    gray_gray_url: https://fh01.feihe.com/tmall/trade/sync
    gray_token: xxx
    gray_switch: false
  vopvip:
    # 唯品会不需要配置推送地址 唯品会采用定时任务主动拉单模式
    gray_outer_user_id:
    gray_outer_skuid:
    gray_gray_url: 
    gray_token: 
    gray_switch: false
#=================== 三方拉单灰度配置 end ======================
```

灰度ACM配置

```text
MSE：
实例名称：飞鹤-业务中台-UAT环境
实例id：mse_prepaid_public_cn-oew1tzqha02
命名空间：FH-ACM-UAT
命名空间id: af32cba7-037f-4398-bf33-c59c192c64a0
groupId：com.alibaba.adapter
dataId：adapter-center-tb-prod2-new-fh-gray.yaml


#=================== 三方拉单灰度配置 start ======================
gray:
  douyin:
    gray_outer_user_id:
    gray_outer_skuid:
    gray_gray_url: http://fh01.feihe.com/tiktok/trade/order/msg?monitor
    gray_token: xxx
    gray_switch: false
  jd:
    gray_outer_user_id:
    gray_outer_skuid:
    gray_gray_url: https://fh01.feihe.com/jd/message/notifyMessage
    gray_token: xxx
    gray_switch: false
  kuaishou:
    gray_outer_user_id:
    gray_outer_skuid:
    gray_gray_url: https://fh01.feihe.com/kuaishou/trade/event/
    gray_token: xxx
    gray_switch: false
  pdd:
    # pdd没有用户ID配置
    gray_outer_user_id:
    gray_outer_skuid:
    gray_gray_url: https://fh01.feihe.com/pdd/sendPddMessage
    gray_token: xxx
    gray_switch: false
  tmall:
    gray_outer_user_id: 
    gray_outer_skuid:
    gray_gray_url: https://fh01.feihe.com/tmall/trade/sync
    gray_token: xxx
    gray_switch: false
  vopvip:
    # 唯品会不需要配置推送地址 唯品会采用定时任务主动拉单模式
    gray_outer_user_id:
    gray_outer_skuid:
    gray_gray_url: 
    gray_token: 
    gray_switch: false
#=================== 三方拉单灰度配置 end ======================
```



生产环境星妈会token

```text
鉴权结构体公钥：
{
	"kty":"RSA",
	"e":"AQAB",
	"n":"wFdvZGojYrtC_wyrT-2Ey95firjDLIfT4kX1Y9LuYTDFIDW1KvQlNahliuWgHtnWoe_YARWR8ykrCuiiSRwbJuvldJ4XVz7RCF7Pp4MSBt29JJumvc39z8yNXMbGCaFAajPJTCUwpqpeT8wtYFHPW5fpXdhgqTnL9i_E5InQOOm55-60yR_MQEwT-bxoXlAwo3HehyYLvK0DT5GVdo4FEhjoWqYrPy9wHLzTmxNQ5tboC080qrGz8AAPAcKo-OYFX-WbsAc4PQd_pbkcOGS346rwt5kDYf37zgITTVOfpaEpS8vPomqVYi_NvIK0wvWyVX87VXIpyFK5evof81mNOQ"
}
token：
eyJhbGciOiJSUzI1NiIsImtpZCI6IjU2OWYzZWJhLTRhZDgtNGUwZS1iYzgwLTRlYjFlZmVkMGZiMSJ9.eyJqdGkiOiJ4U0d5V1dQRElWVi1qQUZuUWt0NmFRIiwiaWF0IjoxNjkwMjc5NjI0LCJleHAiOjQ4MTIzNDM2MjQsIm5iZiI6MTY5MDI3OTU2NCwic3ViIjoiaHR0cDovL2FsaWJhYmFjbG91ZC5jb20iLCJhdWQiOiIiLCJpc3MiOiJodHRwOi8vYWxpYmFiYWNsb3VkLmNvbSIsInVzZXJJZCI6IjEyMTMyMzQiLCJlbWFpbCI6InVzZXJFbWFpbEB5b3VhcHAuY29tIn0.vkp6i9zD7MZdJygku1i1grMelZKHs_stkO0A_FxIiLJpx6vZU9BPXgpHt0dtlYBm_9HXODXhIUdLTXSJ9lKNVBPX2dixqh8PvhmIrvTwIcKipnoUcnWyDxA-Yh9XRjQPvNKXkBpAWJzzOZzLF-JTj8ROcCVf1mMOqW-cQ9d9IGm6WYbLOILVOwiFgwrRY2fdMNZxTaJGW5h_VG3AWxFaKMf0GO3y4T9khpFxe340hv67DREdYY3O7qLmn24gzYYkhr0MKkKn1wsP_QopdqtfM5RvXu8YBZpbR3oaRR1ctZ4w7Fx7CIjXLz0vq_hYdp4mF3vElvtM_l53N37jcRK-gA
id：
569f3eba-4ad8-4e0e-bc80-4eb1efed0fb1
```

生产环境班牛token

```text
鉴权结构体公钥：
{
	"kty":"RSA",
	"e":"AQAB",
	"n":"3I0iJ9kW0CVaw76s8RorxQ9EZLZPCnfT6Tkz_prcPbtpgV_ez5ClHay4PwIe4O3L3k1qtvZXQt7pLczsCumMLzHSS6bRntze37GnI8_VxFS48geQ2sk-qwCQ4fuqoFFclfi37r4o-giHLSOOStunkbmrYK0RV4viKLuve29EmxBIHX3Z2jGnE0Zw1oAKMjPU6nr3xNkoVsh6ixWFRxXkex517J0QaKT_MlA07A63Z_kqzvJbY6HdLWIXLylxSaGfj1A54jPskz4WAcRWV-_KsJ7_PgfAaprJW6TnD62_IJKowY7aWiFw8338QU_2SoIaL9KL1a15Urgs20iyZdozRw"
}
token：
eyJhbGciOiJSUzI1NiIsImtpZCI6IjhlODkwYzY2LWZmZWEtNDU2Ni05YjA3LWJkMmVmOWEzZTQ3MiJ9.eyJqdGkiOiJ3T0Z2Nkhqd2huRHdJX2VmTm5KZG9nIiwiaWF0IjoxNjkwMzg2OTk2LCJleHAiOjQ4MTI0NTA5OTYsIm5iZiI6MTY5MDM4NjkzNiwic3ViIjoiaHR0cDovL2FsaWJhYmFjbG91ZC5jb20iLCJhdWQiOiIiLCJpc3MiOiJodHRwOi8vYWxpYmFiYWNsb3VkLmNvbSIsInVzZXJJZCI6IjEyMTMyMzQiLCJlbWFpbCI6InVzZXJFbWFpbEB5b3VhcHAuY29tIn0.wojEX_YItRVQ6B0gorA12qKQxpld6ApXMB6JcdfOE-Q2dx4MGlryEdVucN2F2yV9ZLUDOm_0wL89JI-0G1S8_3MqJrd8mQLGCB7hza-15Jlmm1uA9X-7MHE5dWsTESVHQgV-kQlglHzXJLBOXdEKq4httVxDNFnDQxJbXEAw6LP3jznFPDTZuk5QOxnNngRG8FfV82brmDx6CHKio5aCm90v099nuOL6FEUZl-qeU8F4-s7i-FiYYYi9KOA2q8qLF2EVd5AuJ_Y8FxzAugdKXN5M8v9-hTp_c7RSbdnITgKAjqYUzcKZSgU-b5y4pyYV0y_DYksC-iEJ7LJ4VITz3Q
id：
8e890c66-ffea-4566-9b07-bd2ef9a3e472
```



⚠️注意：

天猫测试品报文中没有skuid。

天猫用户id短时间不变。



唯品会有用户ID 且 短时间唯一。

唯品会有skuid。



拼多多没有用户ID。

拼多多有订单skuid。需要查订单详情。











retailforce_oms_pro/query_merchant_paytool_confs

retailforce_oms_pro/cuanhuo_channel

retailforce_oms_pro.api.cuanhuo_channel

retailforce_oms/enterprise_list_channel_at_page

retailforce_oms.api.enterprise_list_channel_at_page



设置平台/添加平台

enterprise_list_channel_at_page

enterprise_platform_list_platform_at_page





retailforce_oms/enterprise_channel_rel_platform



retailforce_oms/enterprise_update_channel_platform_rel



retailforce_crm.api.userCommonEventQueryList

retailforce_crm/userCommonEventQueryList



JXH-优选分销商家-经销门店分销业务2-门店





fh_oms/generateGuiderShareCode
